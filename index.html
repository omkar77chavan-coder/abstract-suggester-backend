<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Abstract & Conclusion Generator</title>
<style>
    body {
        background-color: #000;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        color: white;
    }
    .container {
        display: flex;
        justify-content: center;
        padding: 20px;
    }
    .panel {
        background-color: #111;
        padding: 20px;
        border-radius: 10px;
        margin: 10px;
        flex: 1;
    }
    .camera-box {
        width: 100%;
        height: 200px;
        background: #222;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 15px;
        text-align: center;
    }
    .status-text {
        font-size: 14px;
        padding-top: 5px;
    }
    textarea, input, select {
        width: 100%;
        padding: 10px;
        margin: 5px 0 15px 0;
        background: #222;
        border: 1px solid #333;
        color: white;
        border-radius: 5px;
    }
    button {
        width: 100%;
        padding: 10px;
        background-color: #0066ff;
        color: white;
        font-size: 16px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    .abstract-box, .conclusion-box {
        background: #1b1b1b;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        border-left: 3px solid #0066ff;
    }
</style>
<script src="https://webgazer.cs.brown.edu/webgazer.js"></script>
</head>
<body>

<div class="container">
    <!-- Left Column -->
    <div class="panel">
        <div class="camera-box" id="cameraContainer">
            <div id="gazeStatusDisplay" class="status-text">
                Gaze Status: <span id="gazeStatusText" style="color:yellow">Detecting...</span>
            </div>
        </div>
        <label>Name:</label>
        <input type="text" id="name">

        <label>Age:</label>
        <input type="number" id="age">

        <label>Gender:</label>
        <select id="gender">
            <option>Male</option>
            <option>Female</option>
        </select>

        <label>Stream:</label>
        <select id="stream">
            <option>Data Science</option>
            <option>Computer Science</option>
            <option>Electronics</option>
            <option>Mechanical</option>
            <option>Civil</option>
        </select>

        <label>Academic Level:</label>
        <select id="academicLevel">
            <option>Undergraduate</option>
            <option>Postgraduate</option>
        </select>

        <label>Write your Abstract:</label>
        <textarea id="abstract" placeholder="Please write at least 15 words"></textarea>
        <small id="wordCount" style="color:gray">Words: 0</small>

        <button onclick="generateContent()">Generate Abstract & Conclusion</button>
    </div>

    <!-- Right Column -->
    <div class="panel">
        <h2>Generated Content</h2>
        <div class="abstract-box" id="suggestedAbstract">Suggested Abstract:</div>
        <div class="conclusion-box" id="suggestedConclusion">Suggested Conclusion:</div>
    </div>
</div>

<script>
let gazeDirection = null;
let gazeStartTime = null;
window.currentGazeStatus = "unstable";

function trackGazeMovement(x, y) {
    const screenWidth = window.innerWidth;
    const leftBoundary = screenWidth * 0.3;
    const rightBoundary = screenWidth * 0.7;

    let currentDirection = "centered";
    if (x < leftBoundary) currentDirection = "left";
    else if (x > rightBoundary) currentDirection = "right";

    if (currentDirection !== gazeDirection) {
        gazeDirection = currentDirection;
        gazeStartTime = Date.now();
    }

    const elapsed = (Date.now() - gazeStartTime) / 1000;

    let status = "unstable";
    if (gazeDirection === "centered" && elapsed >= 3) {
        status = "centered";
    } else if ((gazeDirection === "left" || gazeDirection === "right") && elapsed >= 2) {
        status = "offcenter";
    }

    window.currentGazeStatus = status;

    const statusText = document.getElementById('gazeStatusText');
    if (statusText) {
        statusText.textContent = status;
        statusText.style.color = status === "centered" ? "lime" :
                                  status === "offcenter" ? "orange" : "red";
    }
}

function initWebGazer() {
    webgazer.setRegression('ridge')
        .setTracker('clmtrackr')
        .showPredictionPoints(true)
        .setGazeListener((data) => {
            if (!data) return;
            trackGazeMovement(data.x, data.y);
        })
        .begin();

    setTimeout(() => {
        const videoElement = document.getElementById('webgazerVideoFeed');
        if (videoElement) {
            const container = document.getElementById('cameraContainer');
            container.insertBefore(videoElement, container.firstChild);
            videoElement.style.width = '100%';
            videoElement.style.height = '160px';
            videoElement.style.objectFit = 'cover';
        }
    }, 1500);
}

function generateContent() {
    const name = document.getElementById("name").value;
    const age = document.getElementById("age").value;
    const gender = document.getElementById("gender").value;
    const stream = document.getElementById("stream").value;
    const academicLevel = document.getElementById("academicLevel").value;
    const abstract = document.getElementById("abstract").value;

    fetch("http://127.0.0.1:5000/generate", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            name, age, gender, stream, academicLevel, abstract,
            gazeStatus: window.currentGazeStatus
        })
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("suggestedAbstract").innerHTML = "<strong>Suggested Abstract:</strong> " + data.abstract;
        document.getElementById("suggestedConclusion").innerHTML = "<strong>Suggested Conclusion:</strong> " + data.conclusion;
    })
    .catch(() => alert("Error fetching suggestion"));
}

document.addEventListener("DOMContentLoaded", () => {
    initWebGazer();
    document.getElementById("abstract").addEventListener("input", function() {
        const words = this.value.trim().split(/\s+/).filter(Boolean).length;
        document.getElementById("wordCount").innerText = `Words: ${words}`;
    });
});
</script>

</body>
</html>

