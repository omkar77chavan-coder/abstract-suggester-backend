<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Abstract Generator</title>
<style>
  body,html {margin:0;padding:0;height:100%;overflow:hidden;font-family:Segoe UI,Arial,sans-serif;background:#0d1014;color:#e9eef5}
  .sa-wrap {display:flex;flex-direction:row;width:100%;height:100vh}
  .sa-col {flex:1;padding:20px;box-sizing:border-box;overflow:hidden}
  .sa-card {background:#13161a;border-radius:12px;padding:16px;height:100%;display:flex;flex-direction:column}
  .sa-cam {flex:0 0 240px;position:relative;border:3px solid #333;border-radius:8px;overflow:hidden;margin-bottom:16px}
  #webcam {width:100%;height:100%;object-fit:cover}
  .green-ring{border:3px solid lime!important}.red-ring{border:3px solid red!important}
  .sa-gaze-overlay{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.6);padding:4px 10px;border-radius:6px;font-size:13px;color:#fff}
  .sa-label{margin:6px 0 4px 0;font-size:13px;color:#a7b0bc}
  .sa-input,.sa-select,.sa-textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #2a2f36;background:#0d1014;color:#e9eef5}
  .sa-textarea{min-height:100px}
  .sa-btn{margin-top:12px;padding:12px;background:linear-gradient(180deg,#4da3ff,#2b6bb3);border:none;border-radius:8px;font-weight:700;color:#fff;cursor:pointer}
  .sa-btn:disabled{opacity:.5;cursor:not-allowed}
  .sa-output{margin-top:10px;background:#0d1014;border:1px solid #2a2f36;border-left:4px solid #4da3ff;padding:12px;border-radius:8px;white-space:pre-line}
</style>
</head>
<body>
<div class="sa-wrap">
  <!-- Left Column -->
  <div class="sa-col">
    <div class="sa-card">
      <h2>Smart Abstract & Conclusion Generator</h2>
      <div class="sa-cam" id="saCam">
       <video id="webcam" autoplay playsinline muted style="width:100%; height:100%; object-fit:cover; background:black; border-radius:12px;"></video>

        <div class="sa-gaze-overlay">Gaze: <span id="saGazeVal">Detecting…</span></div>
      </div>
      <label class="sa-label">Name</label>
      <input id="saName" class="sa-input" type="text">
      <label class="sa-label">Age</label>
      <input id="saAge" class="sa-input" type="number">
      <label class="sa-label">Gender</label>
      <select id="saGender" class="sa-select"><option value="">Select</option><option>Male</option><option>Female</option></select>
      <label class="sa-label">Academic Level</label>
      <select id="saLevel" class="sa-select"><option value="">Select</option><option value="UG">Undergraduate</option><option value="PG">Postgraduate</option></select>
      <label class="sa-label">Stream</label>
      <select id="saStream" class="sa-select"><option value="">Select</option><option>AI</option><option>ML</option></select>
      <label class="sa-label">Write Abstract (min 15 words)</label>
      <textarea id="saInputAbs" class="sa-textarea"></textarea>
      <div id="saWordCount" style="font-size:12px;color:#a7b0bc">Words: 0</div>
      <button id="saBtn" class="sa-btn" disabled>Generate Abstract & Conclusion</button>
      <div id="saStatus" style="margin-top:8px;font-size:13px"></div>
    </div>
  </div>

  <!-- Right Column -->
  <div class="sa-col">
    <div class="sa-card">
      <h2>Generated Content</h2>
      <label class="sa-label">Suggested Abstract</label>
      <div id="saOutAbs" class="sa-output"></div>
      <label class="sa-label">Suggested Conclusion</label>
      <div id="saOutCon" class="sa-output"></div>
    </div>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);
const BACKEND_URL = "https://abstract-suggester-backend.onrender.com/suggest";

let locked = false;

// ====== Camera Fix ======
async function initCam(){
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { width: 640, height: 480, facingMode: "user" } // ✅ front camera
    });
    const cam = $("webcam");
    cam.srcObject = stream;
    await cam.play().catch(err => console.warn("Autoplay prevented:", err)); // ✅ ensures playback
  } catch(e) {
    console.log("Camera error:", e);
    $("saStatus").textContent = "Camera unavailable — button still works.";
  }
}
initCam();

// ====== Word Count ======
$("saInputAbs").addEventListener("input", () => {
  const count = $("saInputAbs").value.trim().split(/\s+/).filter(w => w).length;
  $("saWordCount").textContent = "Words: " + count;
  $("saBtn").disabled = count < 15;
});

// ====== Fetch Suggestion ======
async function fetchSuggestion(level, stream, gaze){
  if(locked) return;
  try {
    const payload = {
      academicLevel: level,
      stream: stream,
      abstractInput: $("saInputAbs").value,
      gazeStatus: gaze
    };
    const r = await fetch(BACKEND_URL, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });
    const d = await r.json();
    $("saOutAbs").textContent = d.abstract || "";
    $("saOutCon").textContent = d.conclusion || "";
    $("saStatus").textContent = "Generated successfully!";
    locked = true;
  } catch(e) {
    $("saStatus").textContent = "Error: " + e;
  }
}

$("saBtn").addEventListener("click", () => {
  fetchSuggestion($("saLevel").value, $("saStream").value, "manual");
});

// ====== Initial check on page load ======
(function(){
  const count = $("saInputAbs").value.trim().split(/\s+/).filter(w => w).length;
  $("saWordCount").textContent = "Words: " + count;
  $("saBtn").disabled = count < 15;
})();
</script>

</body>
</html>
